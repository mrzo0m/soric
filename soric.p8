pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
-- soric man
#include logger.lua
#include utils.lua
#include component.lua
#include keyboard.lua
#include sprite.lua
#include motion.lua
#include transform.lua
#include entity.lua
#include player.lua
#include system.lua
#include movement.lua
#include playerinput.lua
#include render.lua
#include statemachine.lua
soric_sp=1
soric_flip=false
--soric_anim_time=0
debug=true
ren=nil
mvm=nil

velx=nil
vely=nil

logger = getlogger()
machine = getstatemachine()
--components
component = getcomponent()
keyboard = getkeyboard()
sprite = getsprite()
motion = getmotion()
transform = gettransform()
--entitys
entity = getentity()
player = getplayer()
--systems
system = getsystem()
render = getrender()
movement = getmovement()
playerinput = getplayerinput()
fsm=nil
pl=nil
function _init()
	
fsm = machine.create({
  initial = 'green',
  events = {
    { name = 'warn',  from = 'green',  to = 'yellow' },
    { name = 'panic', from = 'yellow', to = 'red'    },
    { name = 'calm',  from = 'red',    to = 'yellow' },
    { name = 'clear', from = 'yellow', to = 'green'  }
}})
 
 local soric_spr = sprite(1,2,2,true,false,13)
 local soric_trf = transform(1,59)

 
 pl = player(2)
 
 local soric_motion = motion(0,0,0.000,0.0001)
 
 local soric_keyb = keyboard(false,false,false,false,false,false)
 

 pl:add(soric_spr)
 pl:add(soric_trf)
 pl:add(soric_motion)
 pl:add(soric_keyb)


 ren = render()
 ren:register_entity(pl)
 
 mvm = movement()
 mvm:register_entity(pl)
 
 inpt = playerinput()
 inpt:register_entity(pl)
end

function _update()

 local cur_time = time()
 
  mvm:update(cur_time)
  inpt:update(cur_time)
 --[[
 if cur_time - soric_anim_time > 0.2 then
			soric_anim_time = time() 
	
 end ]]--
 
 if btn(4) then 
  print(fsm.current)
  fsm:warn()
 end
 
 
 if btn(5) then 
  print(fsm.current)
  fsm:clear()
 end
  
   
end

function _draw()
  cls()
  local trf = pl:get("transform")
  local x = trf:get_x()
  local y = trf:get_y()
  camera(-64+x+8, -64+y+8)
  map()
  camera()
 print(mget(0,1))
 
 -- spr(soric_sp,56,56,2,2,true)
 

 print(fsm.current)
 print(fsm.currentTransitioningEvent)
 ren:render()
 
 --print(velx.." "..vely)
end


__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000970000000000000000
007007000000009740000000000000097000000000000000000000000000000000000000000000000000000000009997400000000000999744d0000000000000
00077000000099974000000000000999700000000000000000000000000000000000000000000000000000002999ff07444d00000009ff07444dd00000000000
000770002999ff07444ddd0002999ff0744dd0000000097000dd0000000009700000000000007000d4d0000000fffff94444d0000009fff94444dd0000000000
0070070000fffff94444ddd0000fffff9444dd0000099077454dd0000009907745d000000009744d45dd00000000099994444dd0009ff99994444dd000000000
000000000000099994444dd00000009994444dd02999fff94444dd002999fff944ddd00000907f4944d4400000000099449445d002ff0099449445d000000000
0000000000000099449445d000000009949445d00fffff9949445d000fffff9949445d00009fff49445450000000004999944440000000499994444000000000
00000000000000099994444000000009999444440000009999444440000004999944440009f0099994444d000000044444444450000044444444445000000000
0000000000000004444444500000000444444454000000444444454000000444444445400f004444444445000000040044455455000000000445545500000000
00000000000000040445545000000000404004500000044404004500000004000400450020040400004405500000000040004405000000000040440500000000
00000000000000040040440000000004040005400000000000000550000000000000050000000000000000500000000000000550000000000000005000000000
00000000000000000050000000000000000050000000000000000050000000000000005000000000000000050000000000000000000000000000050000000000
00000000000000000500000000000000000500000000000000000005000000000000000500000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00009997400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0009ff07444d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0009fff94444d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
009ff99994444dd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02ff0099449445d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000049999444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00004444444444500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000004400004550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000004000044050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555bbbbbbbb44444444bbbbbbbb444454440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555b4b4b4b444444549b444b4b4944444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
555555554b444bbb4444444444444444494444d40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555b4b444b44444444444444444444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555444444444454444444444444445444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555444444444d444444444444444d4494440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555444444444444444444444444444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555444444444444444544444444444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
4143414341434341414241414343434300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4242444242424444444242424242444200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4242444242444442424444424242444200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4242424242444444424242444442444200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4244424442424444444442444442444200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4444444444424244424444444242444200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4242424242424244424444424444444200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4242444444444444444442424242444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4242424242424242424242424242444200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
